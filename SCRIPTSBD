DROP TABLE IF EXISTS avisosAreas;
DROP TABLE IF EXISTS avisosXaulas;
DROP TABLE IF EXISTS eventoshistorial;
DROP TABLE IF EXISTS comer;
DROP TABLE IF EXISTS comidas;
DROP TABLE IF EXISTS animais;
DROP TABLE IF EXISTS xaulas;
DROP TABLE IF EXISTS areas;
DROP TABLE IF EXISTS coidadores;
DROP TABLE IF EXISTS contables;
DROP TABLE IF EXISTS usuarios;

CREATE TABLE usuarios (
dni char(10) not null,
pass varchar(50) not null,
nome varchar(100) not null,
telefono varchar(30) not null,
email varchar(50),
PRIMARY KEY (dni)
);

CREATE TABLE coidadores (
dni char(10) not null,
PRIMARY KEY (dni),
FOREIGN KEY (dni) REFERENCES usuarios(dni) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE contables (
dni char(10) not null,
PRIMARY KEY (dni),
FOREIGN KEY (dni) REFERENCES usuarios(dni) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE areas (
id numeric not null,
climatizacion varchar(50),
PRIMARY KEY (id)
);

CREATE TABLE xaulas (
id numeric not null,
idArea numeric not null,
PRIMARY KEY (id, idArea),
FOREIGN KEY (idArea) REFERENCES areas(id) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE animais (
id numeric not null,
nome varchar(50) not null,
especie varchar(50) not null,
edad integer not null,
peso integer not null,
sexo varchar(10) not null,
idXaula numeric not null,
idArea numeric not null,
PRIMARY KEY (id),
FOREIGN KEY (idXaula, idArea) REFERENCES xaulas(id, idArea) ON DELETE RESTRICT ON UPDATE CASCADE
);

CREATE TABLE comidas (
id numeric not null,
nome varchar(50) not null,
cantidadeRestante numeric not null,
unidades varchar(10) not null,
PRIMARY KEY (id)
);

CREATE TABLE comer (
cantidad integer not null,
animal numeric not null,
comida numeric not null,
PRIMARY KEY (animal, comida),
FOREIGN KEY (animal) references animais(id) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY (comida) references comidas(id) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE eventosHistorial (
tipo varchar(50) not null,
animal numeric not null,
nome varchar(50) not null,
descripcion varchar(300) not null,
dataInicio date not null,
dataFin date,
coidador char(10) not null,
contable char(10),
tratamento varchar(500),
PRIMARY KEY (nome, dataInicio),
FOREIGN KEY (animal) references animais(id) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY (coidador) references coidadores(dni) ON DELETE RESTRICT ON UPDATE CASCADE,
FOREIGN KEY (contable) references contables(dni) ON DELETE RESTRICT ON UPDATE CASCADE
);

CREATE TABLE AvisosAreas (
area numeric not null,
nome varchar(50) not null,
descripcion varchar(2000) not null,
dataInicio date not null,
dataFin date,
coidador char(10) not null,
contable char(10),
tratamento varchar(500),
PRIMARY KEY (area, nome, dataInicio),
FOREIGN KEY (area) references areas(id) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY (coidador) references coidadores(dni) ON DELETE RESTRICT ON UPDATE CASCADE,
FOREIGN KEY (contable) references contables(dni) ON DELETE RESTRICT ON UPDATE CASCADE
);

CREATE TABLE AvisosXaulas (
area numeric not null,
xaula numeric not null,
nome varchar(50) not null,
descripcion varchar(2000) not null,
dataInicio date not null,
dataFin date,
coidador char(10) not null,
contable char(10),
tratamento varchar(500),
PRIMARY KEY (area, xaula, nome, dataInicio),
FOREIGN KEY (xaula, area) references xaulas(id, idArea) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY (coidador) references coidadores(dni) ON DELETE RESTRICT ON UPDATE CASCADE,
FOREIGN KEY (contable) references contables(dni) ON DELETE RESTRICT ON UPDATE CASCADE
);

INSERT INTO usuarios (dni, nome, pass, telefono) VALUES ('12345678A', 'Miguel', 'pass', '612121212');
INSERT INTO usuarios (dni, nome, pass, telefono, email) VALUES ('12345678B', 'Isma', 'pass', '634343434', 'email@example.com');

INSERT INTO coidadores (dni) VALUES ('12345678B');

INSERT INTO Areas (id, climatizacion) VALUES ('00001','Tropical');

INSERT INTO XAULAS (id, idArea) VALUES ('00001','00001');
INSERT INTO XAULAS (id, idArea) VALUES ('00002','00001');
INSERT INTO XAULAS (id, idArea) VALUES ('00003','00001');
INSERT INTO XAULAS (id, idArea) VALUES ('00004','00001');

INSERT INTO animais (id, nome, especie, edad, peso, sexo, idXaula, idArea) VALUES ('00001', 'Simba', 'Leon', 5, 100, 'Macho', '00001','00001');
INSERT INTO animais (id, nome, especie, edad, peso, sexo, idXaula, idArea) VALUES ('00002', 'Baloo', 'Oso', 7, 80, 'Macho', '00002','00001');
INSERT INTO animais (id, nome, especie, edad, peso, sexo, idXaula, idArea) VALUES ('00003', 'Timon', 'Suricato', 5, 10, 'Macho', '00003','00001');
INSERT INTO animais (id, nome, especie, edad, peso, sexo, idXaula, idArea) VALUES ('00004', 'Pumba', 'Jabal√≠', 5, 55, 'Macho', '00004','00001');